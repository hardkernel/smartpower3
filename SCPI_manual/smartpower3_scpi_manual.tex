\documentclass[a4paper,10pt]{article}
\usepackage[left=2.5cm,right=2.5cm,top=2cm]{geometry}
\usepackage{fontenc}
\usepackage{lmodern}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{lmodern}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{graphicx}
\usepackage{color}
\usepackage{xcolor}
\usepackage{url}
\usepackage{textcomp}
\usepackage{listings}
\usepackage{hyperref}

\title{Hardkernel SmartPower3 SCPI manual}
\author{Lukáš Říha}
\date{\today}

\begin{document}
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}}
\renewcommand{\labelenumiii}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}}
\renewcommand{\labelenumiv}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.\arabic{enumiv}}

\maketitle
\tableofcontents


\section{Introduction}

SmartPower3 is a small power supply designed to provide power supply to up to two connected devices and measure and log the connected devices power consumption. The first firmware versions allowed control of the SmartPower3 via devices buttons, rotary encoder and display. As the system became more mature, some users showed interest in remote control of the power supply. New versions added more refined functionality and SCPI (Standard Commands for Programmable Instruments) capability - effectively enabling (at least partial) remote control of the SmartPower3. This manual tries to describe the commands available in SCPI device mode. 

For more information regarding SCPI and its usage please see the online specification and description available at:\newline\href{http://www.ivifoundation.org/docs/scpi-99.pdf}{http://www.ivifoundation.org/docs/scpi-99.pdf}\newline
and other online resources.

\section{Device modes}

The SmartPower3 device can basically be used in two modes - the default original "buttons and screen" mode and SCPI mode. The default (original) mode tries to be compatible in function with the previous firmware version, while SCPI mode allows programming of the device via serial using SCPI commands and (like the default mode) optionally output logging information to WiFi connected UDP target.

The mode is changed via screen and encoder, on the second device screen, near the bottom. The option is (surprisingly) called \verb|Mode| and allows setting two options:
\begin{enumerate}
    \item Default - provides re-worked two level serial menu that enables setting SmartPower3 functionality.
    \item SCPI - reserves serial connection for SCPI control of the device.
\end{enumerate}

\section{Commands}

\begin{enumerate}
\item IEEE Mandated Commands
    \begin{description}
        \item These commands are required in any SCPI implementation (SCPI std V1999.0 4.1.1).
    \end{description}
    \begin{enumerate}
        \item \hypertarget{cls}{} 
            \begin{verbatim}*CLS\end{verbatim}
            \begin{description}
                Command clears all registers and error queues.
            \end{description}
        \item \begin{verbatim}*ESE\end{verbatim}
		\item \begin{verbatim}*ESE?\end{verbatim}
		\item \begin{verbatim}*ESR?\end{verbatim}
		\item \begin{verbatim}*IDN?\end{verbatim}
		\item \begin{verbatim}*OPC\end{verbatim}
		\item \begin{verbatim}*OPC?\end{verbatim}
        \item \begin{verbatim}*RST\end{verbatim}
            \begin{description}
                Device reset - return device to defined known state. Turns output voltage off and stops logging output.
            \end{description}
        \item \begin{verbatim}*SRE\end{verbatim}
        \item \begin{verbatim}*SRE?\end{verbatim}
        \item \begin{verbatim}*STB?\end{verbatim}
        \item \begin{verbatim}*TST?\end{verbatim}
        \item \begin{verbatim}*WAI"\end{verbatim}
    \end{enumerate}
\item Required SCPI Commands
    \begin{description}
        \item Commands required by Required SCPI commands (SCPI std V1999.0 4.2.1) 
    \end{description}
    \begin{enumerate}
        \item 
            \begin{verbatim}SYSTem:ERRor[:NEXT]?\end{verbatim}
            \begin{description}
                Query removes the last error from error buffer and reports it. Repeatedly calling this query eventually causes the error buffer to become empty.
            \end{description}
        \item 
            \begin{verbatim}SYSTem:ERRor:COUNt?\end{verbatim}
            \begin{description}
                Query reports number of errors since device start-up or last device clear (Please see \hyperlink{cls}{*CLS} command).
            \end{description}
        \item 
            \begin{verbatim}SYSTem:VERSion?\end{verbatim}
            \begin{description}
                Query that reports SCPI standard version this device should adhere to.
            \end{description}
    \end{enumerate}
\item Non-Required SCPI Commands
    \begin{description}
        \item This section contains commands specific to the device and query or control its main functionality.
    \end{description}
    \begin{enumerate}
        \item
            \begin{verbatim}SYSTem:CAPability?\end{verbatim}
            \begin{description}
                Some desc.
            \end{description}
        \item 
            \begin{verbatim}SYSTem:COMMunicate:NETwork:MAC?\end{verbatim}
            \begin{description}
                This query returns the MAC address of the power supply. MAC address consist of two number groups: the first three bytes are known as the Organizationally Unique Identifier (OUI), which is distributed by the IEEE, and the last three bytes are the device’s unique serial number. The six bytes are separated by hyphens. The MAC address is unique to the instrument and cannot be altered by the user.
                \newline
                Return Param <XX-XX-XX-YY-YY-YY>
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:NETwork:ADDRess\end{verbatim}
		    \begin{description}
		        This command sets the static address of the power supply.
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:NETwork:ADDRess?\end{verbatim}
		    \begin{description}
		        Queries the static IP address of the power supply.
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:NETwork:GATE\end{verbatim}
		    \begin{description}
		        This command sets the Gateway IP address of the power supply. Gateway IP address is represented with 4 bytes each having a range of 0-255 separated by dots.
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:NETwork:GATE?\end{verbatim}
		    \begin{description}
		        Queries the Gateway IP address of the power supply.
	        \end{description}
	    \item 
	        \begin{verbatim}SYSTem:COMMunicate:NETwork:SUBNet <string>\end{verbatim}
	        \begin{description}
	            This command sets the subnet IP Mask of the power supply.
	        \end{description}
	    \item 
	        \begin{verbatim}SYSTem:COMMunicate:NETwork:SUBNet?\end{verbatim}
	        \begin{description}
		        Queries the value of manually set network subnet mask.
		    \end{description}
		%\item 
		%    \begin{verbatim}[SYSTem][:COMMunicate]:NETwork:PORT\end{verbatim}
		%    \begin{description}
		%        This command sets the Port of the Ethernet module of the power supply.
		%    \end{description}
		%\item
		%    \begin{verbatim}[SYSTem][:COMMunicate]:NETwork:PORT?\end{verbatim}
		%    \begin{description}
		%        *
		%    \end{description}
		%\item 
		%    \begin{verbatim}// [SYSTem][:COMMunicate]:NETwork:HOSTname?\end{verbatim}
		%    \begin{description}
		%        This query reads the host name of the Ethernet communications module.
		%    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:NETwork:DHCP\end{verbatim}
		    \begin{description}
		        This command sets the DHCP operating mode of the Ethernet module. If DHCP is set to 1, the module will allow its IP address to be automatically set by the DHCP server on the network. If DHCP is set to 0, the default IP address is set according to .
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:NETwork:DHCP?\end{verbatim}
		    \begin{description}
		        This query reports the DHCP operating mode currently set.
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:SOCKet:ADDRess\end{verbatim}
		    \begin{description}
		        Command sets logging target IP address (UDP logging server address). 
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:SOCKet:ADDRess?\end{verbatim}
		    \begin{description}
		        Queries logging target IP address (UDP logging server address).
		    \end{description}
		\item
		    \begin{verbatim}SYSTem:COMMunicate:SOCKet:PORT\end{verbatim}
		    \begin{description}
		        Command sets logging target port (UDP logging server port).
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:SOCKet:PORT?\end{verbatim}
		    \begin{description}
		        Queries logging target port (UDP logging server port).
		    \end{description}

		\item
		    \begin{verbatim}SYSTem:COMMunicate:SOCKet:CONNect\end{verbatim}
		    \begin{description}
		        Command connects to the target socket. In case of SmartPower3 and UDP WiFi logging, this basically means connecting to WiFi network, the same way one can connect by moving cursor over WiFi icon when disconnected and pressing encoder button.
		    \end{description}
		\item 
		    \begin{verbatim}SYSTem:COMMunicate:SOCKet:DISConnect\end{verbatim}
		    \begin{description}
		        Command disconnects to the target socket. In case of SmartPower3 and UDP WiFi logging, this basically means disconnecting from WiFi network, the same way one can disconnect by moving cursor over WiFi icon when connected and pressing encoder button.
		    \end{description}

        \item
            \begin{verbatim}SYSTem:COMMunicate:SOCKet:FEED <data_handle>\end{verbatim}
            \begin{description}
                Connect or disconnect the logging output to connected socket - WiFi.
                The data handle parameter can be one of two values:
                    \item \verb|LOG| - connect the logging output
                    \item \verb|NONE| - disconnect the logging output
            \end{description}
        \item
            \begin{verbatim}SYSTem:COMMunicate:SOCKet:FEED?\end{verbatim}
            \begin{description}
                Report what data source is connected to the logging output.
                The result can be one of the following values:
                    \item \verb|LOG|
                    \item \verb|NONE|
            \end{description}
        \item
            \begin{verbatim}SYSTem:COMMunicate:SERial:FEED <data_handle>\end{verbatim}
            \begin{description}
                Connect the logging output to connected serial port.
                The data handle parameter can be one of two values:
                    \item \verb|LOG| - connect the logging output
                    \item \verb|NONE| - disconnect the logging output
            \end{description}
        \item
            \begin{verbatim}SYSTem:COMMunicate:SERial:FEED?\end{verbatim}
            \begin{description}
                Report what data source is connected to the logging output.
                The result can be one of the following values:
                    \item \verb|LOG|
                    \item \verb|NONE|
            \end{description}
            
            
            
		% STATus:OPERation:CONDition?
		% STATus:OPERation:ENABle
		% STATus:OPERation:ENABle?

		%\item 
		%    \begin{verbatim}STATus:QUEStionable[:EVENt]?\end{verbatim}
		%    \begin{description}
		%        TBD
		%    \end{description}
		%\item
		%    \begin{verbatim}// STATus:QUEStionable:CONDition?\end{verbatim}
		%    \begin{description}
		%        TBD
		%    \end{description}
		%\item 
		%    \begin{verbatim}STATus:QUEStionable:ENABle\end{verbatim}
		%    \begin{description}
		%        TBD
		%    \end{description}
		%\item 
		%    \begin{verbatim}STATus:QUEStionable:ENABle?\end{verbatim}
		%    \begin{description}
		%        TBD
		%    \end{description}

		%\item 
		%    \begin{verbatim}STATus:PRESet\end{verbatim}
		%    \begin{description}
		%        TBD
		%    \end{description}

		%/* DMM */
		\item \hypertarget{FETCh}{}
		    \begin{verbatim}FETCh[:SCALar]:VOLTage[:DC]? [expected_value, [resolution,]] <channel_list>\end{verbatim}
		    \begin{description}
		        Command allows reading voltage on channel specified by \verb|<channel_list>|. Parameter \verb|expected_value| has no use in this case and is included for reasons of compatibility. Parameter \verb|resolution| allows specifying the resolution of the result. If ommited, the result is returned in Volts. Parameter \verb|<channel_list>| allows specifying which channel(s) result should be read. The order of the channels is important - results are returned in that order.
		        \newline If all parameters are ommited, the command will return value for channel 1, in Volts.
		        \item Example 1:
		            \begin{verbatim}FETCh:VOLTage? 1 V, 0.001V, (@1:3)\end{verbatim} will return voltage read on all three channels (including the power supply supply channel), in milliVolts, in order of channel 1, 2, 3.
		        \item Example 2:
		            \begin{verbatim}FETCh:VOLTage? (@3,1)\end{verbatim} will return voltage read on channels 3 and 1 (in that order), in units of Volts.
		    \end{description}
		\item 
		    \begin{verbatim}FETCh[:SCALar]:CURRent[:DC]? [expected_value, [resolution,]] <channel_list>\end{verbatim}
		    \begin{description}
		        Command allows reading of current on channel specified by \verb|<channel_list>|, averaged over 2 samples. If \verb|resolution| is not specified, the value is returned in Amperes.
		        Parameter \verb|<channel_list>| allows specifying which channel(s) result should be read. The order of the channels is important - results are returned in that order.
		        \newline If all parameters are ommited, the command will return value for channel 1, in Amperes.
		        \item Example 1:
		            \begin{verbatim}FETCh:CURRent? 1 A, 0.001A, (@1:3)\end{verbatim} will return current read on all three channels (including the power supply supply channel), in milliAmperes, in order of channel 1, 2, 3.
		        \item Example 2:
		            \begin{verbatim}FETCh:CURRent? (@3,1)\end{verbatim} will return current read on channels 3 and 1 (in that order), in units of Amperes.
		    \end{description}
		\item 
		    \begin{verbatim}FETCh[:SCALar]:POWer[:DC]? [expected_value, [resolution,]] <channel_list>\end{verbatim}
		    \begin{description}
		        Command allows reading power on channel specified by \verb|<channel_list>|. Parameter \verb|expected_value| has no use in this case and is included for reasons of compatibility. Parameter \verb|resolution| allows specifying the resolution of the result. If ommited, the result is returned in Watts. Parameter \verb|<channel_list>| allows specifying which channel(s) result should be read. The order of the channels is important - results are returned in that order.
		        \newline If all parameters are ommited, the command will return value for channel 1, in Watts.
		        \item Example 1:
		            \begin{verbatim}FETCh:POWer? 1 V, 0.001V, (@1:3)\end{verbatim} will return power read on all three channels (including the power supply supply channel), in milliWatts, in order of channel 1, 2, 3.
		        \item Example 2:
		            \begin{verbatim}FETCh:POWer? (@3,1)\end{verbatim} will return power read on channels 3 and 1 (in that order), in units of Watts.
		    \end{description}

		\item
		    \begin{verbatim}[SOURce#]:CURRent <numeric_value>\end{verbatim}
		    \begin{description}
		        Sets output current on source \verb|#|. If \verb|#| is ommited, the default value is 1.
		        \newline
		        \verb|<numeric_value>| is the value that should be set on the device. Default unit is Amperes. Other possible values include \verb!MIN|MAX!, which set minimum and maximum persmissible value, respectively. Another option, if you decide to use \verb|A| unit is to specify units as fractions, such as \verb|mA| (milliAmperes) or \verb|UA| (microAmperes). 
		    \end{description}
		\item 
		    \begin{verbatim}[SOURce#]:CURRent?\end{verbatim}
		    \begin{description}
		        Querries the output current set on channel \verb|#|. Note that this differs from the \hyperlink{FETCh}{FETCh} series of commands in that no measurements are taken and value set by \verb|[SOURce#]:CURRent| is returned.
		        \newline
		        Returns value in Amperes.
		    \end{description}
		\item 
		    \begin{verbatim}[SOURce#]:VOLTage <numeric_value>\end{verbatim}
		    \begin{description}
		        Sets output voltage on source \verb|#|. If \verb|#| is ommited, the default value is 1.
		        \newline
		        \verb|<numeric_value>| is the value that should be set on the device. Default unit is Volts. Other possible values include \verb!MIN|MAX!, which set minimum and maximum persmissible value, respectively. Another option, if you decide to use \verb|V| unit is to specify units as fractions, such as \verb|mV| (milliVolts) or \verb|UV| (microVolts). 
		    \end{description}
		\item 
		    \begin{verbatim}[SOURce#]:VOLTage?\end{verbatim}
		    \begin{description}
		        Querries the output voltage set on channel \verb|#|. Note that this differs from the \hyperlink{FETCh}{FETCh} series of commands in that no measurements are taken and value set by \verb|[SOURce#]:VOLTage| is returned.
		        \newline
		        Returns value in Amperes.
		    \end{description}

		\item 
		    \begin{verbatim}OUTPut#[:STATe] <parameter>\end{verbatim}
		    \begin{description}
		        This command turns the output channel \verb!#! on or off. If \verb|#| is ommited, the command defaults to channel number 1.
		        \newline Possible parameter value is one of \verb!ON|1|OFF|0!.
		    \end{description}
		\item 
		    \begin{verbatim}OUTPut#[:STATe]?\end{verbatim}
		    \begin{description}
		        This query returns the output states of channel \verb!#!. Returns 0 or 1.
		    \end{description}
    \end{enumerate}
\end{enumerate}

\end{document}